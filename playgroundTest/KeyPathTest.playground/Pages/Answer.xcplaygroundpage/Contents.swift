//: [Previous](@previous)

import Foundation

//ã€ChaoCodeã€‘ Swift ä¸­ç´šç¯‡ 8ï¼šKeyPath å¯¦ä½œä½œæ¥­
//: 1. åœ¨ Array çš„ extension ä¸­å¯«ä¸€å€‹èƒ½æŠŠæ‰€æœ‰è³‡æ–™çš„æŸå€‹ Double å±¬æ€§åŠ ç¸½å¾Œç®—å‡ºå¹³å‡å€¼çš„æ–¹æ³•ã€‚
extension Array {
    func Average(_ path: KeyPath<Element, Double>) -> Double {
        let value = reduce(0) { $0 + $1[keyPath: path] }
        let count = Double(self.count)
        return value / count
    }
}

print([5, 7].Average(\.self))
// âœ¨ ä»¥ä¸‹æ¸¬è©¦è«‹è‡ªè¡Œå®Œæˆï¼Œå‰é¢æ˜¯ Arrayï¼Œç„¶å¾Œæ˜¯è¦è¨ˆç®—å“ªå€‹å±¬æ€§çš„å¹³å‡ï¼Œæœ€å¾Œ == å¾Œé¢æ˜¯é æœŸçµæœï¼Œä½ åªéœ€è¦æŠŠä¸­é–“æ–‡å­—çš„éƒ¨åˆ†æ”¹æˆä½ è¨­è¨ˆçš„æ–¹æ³•ä¸¦æ”¾å…¥ keyPathï¼Œç„¶å¾Œç¢ºèªå…©é‚Šç›¸æ¯”çµæœæ˜¯ true å³å¯
public struct é•·åº¦å–®ä½ {
    public var å…¬å°º: Double
    
    public var å…¬åˆ†: Double { å…¬å°º * 100 }
    public var å…¬é‡Œ: Double { å…¬å°º / 1000 }
    
    public init(m: Double) { å…¬å°º = m }
}

[100, 60, 5.0].Average(\.self) == 55 // é€™å€‹å°±æ˜¯å¹³å‡æ•¸å­—æœ¬èº«
[é•·åº¦å–®ä½(m: 3), é•·åº¦å–®ä½(m: 0.23), é•·åº¦å–®ä½(m: 935), é•·åº¦å–®ä½(m: 1130)].Average(\.å…¬å°º) ==  517.0575
[é•·åº¦å–®ä½(m: 23), é•·åº¦å–®ä½(m: 32.311), é•·åº¦å–®ä½(m: 935), é•·åº¦å–®ä½(m: 113.0)].Average(\.å…¬åˆ†) == 27582.775
 [é•·åº¦å–®ä½(m: 9), é•·åº¦å–®ä½(m: 12321), é•·åº¦å–®ä½(m: 935), é•·åº¦å–®ä½(m: 1.130)].Average(\.å…¬é‡Œ) == 3.3165325


/*: 2. åœ¨ Sequence çš„ extension ä¸­å¯«ä¸€å€‹é€éæŸå€‹å±¬æ€§åˆ†é¡å¾Œå›å‚³å­—å…¸çš„æ–¹æ³•ã€‚
 ```
 å‡è¨­ä¸€ç­†è³‡æ–™æ˜¯ [(name: "å°èŠ³", æ€§åˆ¥: "å¥³"), (name: "å‰å‰", æ€§åˆ¥: "ç”·"), (name: "èŠ¯å®œ", æ€§åˆ¥: "å¥³")]
 é€™ç­†è³‡æ–™ç”¨ã€Œæ€§åˆ¥ã€åˆ†é¡çš„è©±ï¼Œå›å‚³çš„å­—å…¸çµæœå°±æœƒæ˜¯
 ["å¥³": [(name: "å°èŠ³", æ€§åˆ¥: "å¥³"), (name: "èŠ¯å®œ", æ€§åˆ¥: "å¥³")], "ç”·": [(name: "å‰å‰", æ€§åˆ¥: "ç”·")]]
 ```
 */
struct People {
    let name: String
    let æ€§åˆ¥: String
}

let peoples = [People(name: "å°èŠ³", æ€§åˆ¥: "å¥³"), People(name: "å‰å‰", æ€§åˆ¥: "ç”·"), People(name: "èŠ¯å®œ", æ€§åˆ¥: "å¥³")]

extension Sequence {
    func groupBy<T: Hashable>(_ path:KeyPath<Element, T>) -> [T:[Element]] {
        var categories: [T: [Element]] = [:]
//        for element in self {
//            let key = element[keyPath: path]
//            if case nil = categories[key]?.append(element) {
//                categories[key] = [element]
//            }
//        }
        self.forEach {
            categories[$0[keyPath: path], default: []].append($0)
        }
        return categories
    }
}
print(peoples.groupBy(\.æ€§åˆ¥))

public typealias é›»å½± = (åç¨±: String, é¡å‹: String)

public struct èŠ±è²» {
    public var åç¨±: String
    public var è²»ç”¨: Double
    public var é¡åˆ¥: é¡åˆ¥
    public var ä»˜æ¬¾æ–¹å¼: ä»˜æ¬¾æ–¹å¼
    
}

extension èŠ±è²» {
    public enum é¡åˆ¥: String, CustomStringConvertible {
        case é£Ÿ, å¨›æ¨‚, å¸³å–®, è³¼ç‰©, ç¤¾äº¤
        public var description: String { rawValue }
    }
    
    public enum ä»˜æ¬¾æ–¹å¼: String, CustomStringConvertible {
        case ç¾é‡‘, å…¨é¡åˆ·å¡, å…¨é¡åˆ†æœŸ
        public var description: String { rawValue }
    }
}

// ğŸ‘† è³‡æ–™é¡å‹å®£å‘Šåˆ°é€™é‚Šï¼Œå¾Œé¢éƒ½åªæ˜¯æ¸¬è©¦ç”¨çš„ï½

extension èŠ±è²»: CustomStringConvertible, Hashable {
    public var description: String { "[\(self.é¡åˆ¥)] \(åç¨±) - $\(è²»ç”¨) (\(self.ä»˜æ¬¾æ–¹å¼))" }
}


public let spends: Set<èŠ±è²»> = [èŠ±è²»(åç¨±: "é›»è²»", è²»ç”¨: 1590, é¡åˆ¥: .å¸³å–®, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡), èŠ±è²»(åç¨±: "PS5", è²»ç”¨: 15000, é¡åˆ¥: .å¨›æ¨‚, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡), èŠ±è²»(åç¨±: "è€é—†ç¦®ç‰©", è²»ç”¨: 3500, é¡åˆ¥: .ç¤¾äº¤, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡), èŠ±è²»(åç¨±: "é™¤æ¿•æ©Ÿ", è²»ç”¨: 2966, é¡åˆ¥: .è³¼ç‰©, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ†æœŸ), èŠ±è²»(åç¨±: "éº¥ç•¶å‹", è²»ç”¨: 168, é¡åˆ¥: .é£Ÿ, ä»˜æ¬¾æ–¹å¼: .ç¾é‡‘), èŠ±è²»(åç¨±: "å…¨è¯", è²»ç”¨: 789, é¡åˆ¥: .é£Ÿ, ä»˜æ¬¾æ–¹å¼: .ç¾é‡‘), èŠ±è²»(åç¨±: "ä¸­ç§‹ç¦®ç›’", è²»ç”¨:4800 , é¡åˆ¥: .ç¤¾äº¤, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡), èŠ±è²»(åç¨±: "é›»å½±", è²»ç”¨: 400, é¡åˆ¥: .å¨›æ¨‚, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡), èŠ±è²»(åç¨±: "é¡¯å¡", è²»ç”¨: 5900, é¡åˆ¥: .è³¼ç‰©, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ†æœŸ), èŠ±è²»(åç¨±: "ç¶²è·¯è²»", è²»ç”¨: 900, é¡åˆ¥: .å¸³å–®, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡), èŠ±è²»(åç¨±: "æ‰‹æ©Ÿè²»", è²»ç”¨: 599, é¡åˆ¥: .å¸³å–®, ä»˜æ¬¾æ–¹å¼: .å…¨é¡åˆ·å¡)]


public let movies: [é›»å½±] = [("å¥‡ç•°åšå£«2ï¼šå¤±æ§å¤šé‡å®‡å®™", "å‹•ä½œ"),("åŒ—æ–¹äºº", "åŠ‡æƒ…"),("ç©ºæ°£æ®ºäºº", "åŠ‡æƒ…"),("æ€ªç¸èˆ‡é„§ä¸åˆ©å¤šçš„ç§˜å¯†","å¥‡å¹»"),("åª½çš„å¤šé‡å®‡å®™", "å–œåŠ‡"),("æ­»äº¡é å ±", "æ‡¸ç–‘"),("å¤±è½è¬åŸ", "å–œåŠ‡"),("è¶…å‰ä»»å‹™", "å–œåŠ‡"),("å£è›‹è¯ç›Ÿ", "å‹•ç•«"),("æè¡›æˆ°å£«ï¼šç¨è¡Œä¿ ", "å‹•ä½œ"),("çµ‚æ¥µå¤œè·¯", "å‹•ä½œ")]


public func print<Key: Hashable, Value>(_ dict: Dictionary<Key, [Value]>) {
    dict.forEach { (key, value) in
        print("\(key) å…§æœ‰ï¼š")
        value.forEach { print("\t \($0)") }
    }
    print("-------------------")
}

// âœ¨ è«‹ä½¿ç”¨ä»¥ä¸‹å…©å€‹è®Šæ•¸é€²è¡Œåˆ†é¡ï¼Œä¸¦å°å‡ºå›å‚³çš„å­—å…¸ã€‚
// spends è«‹åˆ†åˆ¥å°å‡ºç”¨ã€Œä»˜æ¬¾æ–¹å¼ã€å’Œç”¨ã€Œé¡åˆ¥ã€åˆ†é¡çš„æ–¹å¼
spends
print(spends.groupBy(\.ä»˜æ¬¾æ–¹å¼))
print("======")
print(spends.groupBy(\.é¡åˆ¥))
print("======")
//print(spends.groupBy(\.é¡åˆ¥))
// movies è«‹ç”¨ã€Œé¡å‹ã€åˆ†é¡
movies
print(movies.groupBy(\.é¡å‹))

/*:
 ### æ¦‚å¿µç­”æ¡ˆ
- æ€éº¼é€é KeyPath å­˜å–è³‡æ–™ï¼Ÿ
 ```
 é€éä¸‹æ¨™å­˜å–ã€‚ object[keyPath: KeyPath]
 ```
- KeyPath Literal å¦‚ä½•è¾¨åˆ¥ KeyPath å’Œ Writable KeyPathï¼Ÿ
 ```
 å¦‚æœé¡å‹ä¸­ï¼Œå±¬æ€§è¢«ç”¨ var å®šç¾©å°±æœƒæ˜¯ã€ŒWritable KeyPathã€ï¼Œå¦‚æœæ˜¯ let å°±æœƒæ˜¯ã€ŒKeyPathã€ã€‚
 ```
- è¦æŠŠ KeyPath ç•¶ä½œå¼•æ•¸å‚³é€²éœ€è¦ Closure çš„åƒæ•¸è¦æ³¨æ„ä»€éº¼ï¼Ÿ
 ```
 Closure è¦æ˜¯ (Root) -> Valueï¼Œä¸¦ä¸”å¿…é ˆç”¨ KeyPath literal çš„æ–¹å¼å¯«æ‰èƒ½è‡ªå‹•è¢«è½‰æ›ã€‚
 ```
- é™¤äº†ç°¡åŒ–èªæ³•ä»¥å¤–ï¼Œé‚„æœ‰ä»€éº¼æ™‚å€™ç”¨ KeyPath æ¯” Clousre æ›´å¥½ï¼Ÿ
 ```
 ç•¶ä¸æ‡‰è©²æœ‰å’Œå±¬æ€§äº’å‹•ä»¥å¤–çš„æ“ä½œæ™‚ï¼Œç”¨ KeyPath å¯ä»¥ç¢ºä¿è¢«å‘¼å«æ™‚ä¸æœƒæœ‰é¡å¤–çš„äº‹ä»¶ã€‚
 ```
 */


//: [Next](@next)
